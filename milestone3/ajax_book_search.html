<!DOCTYPE html>
<html>
<head>
    <title>IT 4403 Ryan Guzman</title>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="../styleSheet.css">    
</head>
<body>
    <ul>
        <li class="reverse_nav_items">
            <a href="../index.html" class="reverse_nav_links" id="home">Back to Home</a>
        </li>
    </ul>

    <h1>Search</h1>
    <div id="search-container">
        <input type="text" id="search-input" placeholder="Enter search terms">
        <button id="search-button">Search</button>
    </div>

    <div id="results-container"></div>

    <div class="pagination" id="pagination"></div>

    <div id="book-details-container"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            //variables to keep track of the current search query and result page
            const pagination = document.getElementById('pagination');
            const resultsContainer = document.getElementById('results-container');
            const bookDetailsContainer = document.getElementById('book-details-container');
            const maxResults = 10;
            const totalPages = 5;
            var currentQuery = '';

            // Function to handle the search button click
            document.getElementById('search-button').addEventListener('click', function() {
                // Get the search query from the input field
                const query = document.getElementById('search-input').value.trim();
                var currentPage = 1;
                // Set the current query and reset the current page
                currentQuery = query;

                // Perform the initial search
                searchBooks(currentQuery, currentPage);
                
            });

            //this searches for books
            function searchBooks(query, currentPage) {
                const startIndex = (currentPage - 1) * maxResults; 
                
                //should be able to replace maxResults with hard coded 10
                const url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&startIndex=${startIndex}&maxResults=10`;
                
                const xhr = new XMLHttpRequest();
                xhr.open('GET', url);
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        displayResults(response.items);
                        displayPagination(currentPage);
                    } else {
                        console.log('An error occurred while fetching the books:', xhr.status);
                    }
                };
                xhr.onerror = function() {
                    console.log('An error occurred while fetching the books:', xhr.status);
                };
                xhr.send();
            }

            //this displays search results
            function displayResults(books) {
                
                resultsContainer.innerHTML = '';

                // Iterate over the books and display their information
                for (let i = 0; i < books.length; i++) {
                    const book = books[i];
                    const title = book.volumeInfo.title;
                    const coverImage = book.volumeInfo.imageLinks.thumbnail;

                    // Create a div to hold each book's information
                    const bookDiv = document.createElement('div');
                    bookDiv.className = 'book';

                    const titleElement = document.createElement('h2');
                    titleElement.textContent = title;
                    const coverImageElement = document.createElement('img');
                    coverImageElement.src = coverImage;

                    bookDiv.appendChild(titleElement);
                    bookDiv.appendChild(coverImageElement);
                    resultsContainer.appendChild(bookDiv);

                    // Add a click event listener to display book details when clicked
                    bookDiv.addEventListener('click', function() {
                        displayBookDetails(book);
                    });
                }
            }

            //this displays book details
            function displayBookDetails(book) {

                bookDetailsContainer.innerHTML = '';

                //important information 
                const title = book.volumeInfo.title;
                const authors = book.volumeInfo.authors?.join(', ');
                const description = book.volumeInfo.description;
                const coverImage = book.volumeInfo.imageLinks.thumbnail;

                // elements to display the book details
                const titleElement = document.createElement('h2');
                titleElement.textContent = title;
                const authorsElement = document.createElement('p');
                authorsElement.textContent = 'Author(s): ' + authors;
                const descriptionElement = document.createElement('p');
                descriptionElement.textContent = description;
                const coverImageElement = document.createElement('img');
                coverImageElement.src = coverImage;

                bookDetailsContainer.appendChild(titleElement);
                bookDetailsContainer.appendChild(authorsElement);
                bookDetailsContainer.appendChild(descriptionElement);
                bookDetailsContainer.appendChild(coverImageElement);
            }

            // Function to display pagination
            function displayPagination(currentPage) {
                pagination.innerHTML = ''; // Clear previous pagination

                for (let i = 1; i <= totalPages; i++) {
                    const pageLink = document.createElement('span');
                    pageLink.classList.add('page-link');
                    pageLink.textContent = i;

                    if (i === currentPage) {
                        pageLink.style.fontWeight = 'bold';
                    }

                    pageLink.addEventListener('click', function () {
                        currentPage = i;
                        searchBooks(currentQuery, currentPage);
                    });

                    pagination.appendChild(pageLink);
                }
            }

        });
    </script>
</body>
</html>
